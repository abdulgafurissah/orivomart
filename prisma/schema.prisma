generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Profile {
  id                 String    @id @default(uuid())
  email              String    @unique
  password           String
  fullName           String?   @map("full_name")
  role               String    @default("buyer")
  createdAt          DateTime  @default(now()) @map("created_at")
  currentLat         Float?    @map("current_lat")
  currentLng         Float?    @map("current_lng")
  lastLocationUpdate DateTime? @map("last_location_update")
  trustScore         Int       @default(100) @map("trust_score")
  disputes           Dispute[]
  orders             Order[]   @relation("BuyerOrders")
  seller             Seller?

  @@map("profiles")
}

model Seller {
  id                     String      @id @default(uuid())
  userId                 String      @unique @map("user_id")
  shopName               String      @map("shop_name")
  ownerName              String      @map("owner_name")
  email                  String
  phone                  String?
  image                  String?
  description            String?
  address                String?
  city                   String?
  gpsAddress             String?     @map("gps_address")
  businessAddress        String?     @map("business_address")
  businessRegNum         String?     @map("business_registration_number")
  ghanaCardNum           String?     @map("ghana_card_number")
  kycDocUrl              String?     @map("kyc_document_url")
  verified               Boolean     @default(false)
  status                 String      @default("pending")
  rating                 Decimal     @default(0)
  productsCount          Int         @default(0)
  paystackSubaccountCode String?     @map("paystack_subaccount_code")
  createdAt              DateTime    @default(now()) @map("created_at")
  coverImage             String?     @map("cover_image")
  items                  OrderItem[]
  products               Product[]
  profile                Profile     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sellers")
}

model Product {
  id          String   @id @default(uuid())
  sellerId    String   @map("seller_id")
  name        String
  description String?
  price       Decimal
  stock       Int      @default(0)
  image       String?
  category    String?
  status      String   @default("active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  seller      Seller   @relation(fields: [sellerId], references: [id], onDelete: Cascade)

  @@map("products")
}

model Order {
  id               String      @id @default(uuid())
  buyerId          String?     @map("buyer_id")
  totalAmount      Decimal     @map("total_amount")
  currency         String      @default("GHS")
  status           String      @default("pending")
  paymentReference String?     @map("payment_reference")
  shippingDetails  Json?       @map("shipping_details")
  createdAt        DateTime    @default(now()) @map("created_at")
  commitmentFee    Decimal     @default(0) @map("commitment_fee")
  isCod            Boolean     @default(false) @map("is_cod")
  paymentMethod    String      @default("ONLINE") @map("payment_method")
  remainingBalance Decimal     @default(0) @map("remaining_balance")
  disputes         Dispute[]
  items            OrderItem[]
  buyer            Profile?    @relation("BuyerOrders", fields: [buyerId], references: [id])

  @@map("orders")
}

model OrderItem {
  id             String   @id @default(uuid())
  orderId        String   @map("order_id")
  sellerId       String?  @map("seller_id")
  productId      String   @map("product_id")
  productName    String?  @map("product_name")
  quantity       Int
  price          Decimal
  courierId      String?  @map("courier_id")
  trackingCode   String?  @map("tracking_code")
  deliveryStatus String   @default("pending_pickup") @map("delivery_status")
  deliveryOtp    String?  @map("delivery_otp") // Added for secure delivery
  createdAt      DateTime @default(now()) @map("created_at")
  order          Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  seller         Seller?  @relation(fields: [sellerId], references: [id])

  @@map("order_items")
}

model Dispute {
  id          String   @id @default(uuid())
  orderId     String   @map("order_id")
  buyerId     String   @map("buyer_id")
  reason      String
  description String
  status      String   @default("open")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  buyer       Profile  @relation(fields: [buyerId], references: [id])
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("disputes")
}
